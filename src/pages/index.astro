---
import DigitalGardenLayout from '../layouts/DigitalGardenLayout.astro';
import { getCollection } from 'astro:content';

// Get all posts sorted by date
let recentPosts: any[] = [];
let totalPosts = 0;
try {
  const posts = await getCollection('posts');
  totalPosts = posts.length;
  const sortedPosts = posts.sort(
    (a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
  );
  recentPosts = sortedPosts.slice(0, 6);
} catch {
  // No posts yet
}
---

<DigitalGardenLayout
  title="Tech Notes - Digital Garden"
  showBacklinks={false}
  showMiniGraph={false}
  showToc={false}
>
  <div class="home-page">
    <!-- Welcome Section -->
    <section class="welcome-section">
      <div class="welcome-icon">
        <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <path d="M12 2L2 7l10 5 10-5-10-5z" />
          <path d="M2 17l10 5 10-5" />
          <path d="M2 12l10 5 10-5" />
        </svg>
      </div>
      <h1 class="welcome-title">상상을 현실로 바꾸는 개발자</h1>
      <p class="welcome-name">이승헌입니다</p>
      <p class="welcome-description">
        기술 노트와 아이디어를 기록하고 연결하는 공간입니다.
      </p>
      <div class="welcome-stats">
        <div class="stat-item">
          <span class="stat-value">{totalPosts}</span>
          <span class="stat-label">Notes</span>
        </div>
        <div class="stat-divider"></div>
        <a href="/graph" class="stat-item stat-link">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="3" />
            <circle cx="19" cy="5" r="2" />
            <circle cx="5" cy="19" r="2" />
            <line x1="14.5" y1="9.5" x2="17.5" y2="6.5" />
            <line x1="9.5" y1="14.5" x2="6.5" y2="17.5" />
          </svg>
          <span class="stat-label">View Graph</span>
        </a>
      </div>
    </section>

    <!-- Recent Notes -->
    <section class="recent-section">
      <div class="section-header">
        <h2 class="section-title">Recent Notes</h2>
        <a href="/posts" class="section-link">View all →</a>
      </div>

      {recentPosts.length === 0 ? (
        <div class="empty-state">
          <p>No notes yet. Start writing your first note!</p>
          <p class="empty-hint">
            Create a new <code>.mdx</code> file in <code>src/content/posts/</code>
          </p>
        </div>
      ) : (
        <div class="notes-grid">
          {recentPosts.map((post) => (
            <article class="note-card">
              <a href={`/posts/${post.slug}`} class="note-card-link">
                <time class="note-date" datetime={post.data.date.toISOString()}>
                  {new Date(post.data.date).toLocaleDateString('ko-KR', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric',
                  })}
                </time>
                <h3 class="note-title">{post.data.title}</h3>
                {post.data.excerpt && (
                  <p class="note-excerpt">{post.data.excerpt}</p>
                )}
                {post.data.tags && post.data.tags.length > 0 && (
                  <div class="note-tags">
                    {post.data.tags.slice(0, 2).map((tag: string) => (
                      <span class="post-tag">{tag}</span>
                    ))}
                  </div>
                )}
              </a>
            </article>
          ))}
        </div>
      )}
    </section>

    <!-- Quick Links -->
    <section class="quick-links-section">
      <h2 class="section-title">Explore</h2>
      <div class="quick-links">
        <a href="/posts" class="quick-link">
          <div class="quick-link-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
              <polyline points="14 2 14 8 20 8" />
              <line x1="16" y1="13" x2="8" y2="13" />
              <line x1="16" y1="17" x2="8" y2="17" />
            </svg>
          </div>
          <div class="quick-link-content">
            <span class="quick-link-title">All Notes</span>
            <span class="quick-link-desc">Browse all notes chronologically</span>
          </div>
        </a>
        <a href="/graph" class="quick-link">
          <div class="quick-link-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="3" />
              <circle cx="19" cy="5" r="2" />
              <circle cx="5" cy="19" r="2" />
              <line x1="14.5" y1="9.5" x2="17.5" y2="6.5" />
              <line x1="9.5" y1="14.5" x2="6.5" y2="17.5" />
            </svg>
          </div>
          <div class="quick-link-content">
            <span class="quick-link-title">Knowledge Graph</span>
            <span class="quick-link-desc">Visualize connections between notes</span>
          </div>
        </a>
        <a href="/tags" class="quick-link">
          <div class="quick-link-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z" />
              <line x1="7" y1="7" x2="7.01" y2="7" />
            </svg>
          </div>
          <div class="quick-link-content">
            <span class="quick-link-title">Tags</span>
            <span class="quick-link-desc">Browse notes by topic</span>
          </div>
        </a>
        <a href="/about" class="quick-link">
          <div class="quick-link-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10" />
              <line x1="12" y1="16" x2="12" y2="12" />
              <line x1="12" y1="8" x2="12.01" y2="8" />
            </svg>
          </div>
          <div class="quick-link-content">
            <span class="quick-link-title">About</span>
            <span class="quick-link-desc">Learn more about this garden</span>
          </div>
        </a>
      </div>
    </section>
  </div>
</DigitalGardenLayout>

<style>
  .home-page {
    max-width: 800px;
    margin: 0 auto;
  }

  /* Welcome Section */
  .welcome-section {
    text-align: center;
    padding: 2rem 0 3rem;
    border-bottom: 1px solid var(--bg-tertiary);
    margin-bottom: 2rem;
  }

  .welcome-icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 64px;
    height: 64px;
    background: var(--bg-tertiary);
    border-radius: 16px;
    margin-bottom: 1.5rem;
    color: var(--accent-primary);
  }

  .welcome-title {
    font-size: 1.75rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
    letter-spacing: -0.02em;
    line-height: 1.3;
  }

  .welcome-name {
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--accent-primary);
    margin-bottom: 1rem;
    letter-spacing: -0.01em;
  }

  .welcome-description {
    color: var(--text-secondary);
    font-size: 1rem;
    line-height: 1.8;
    letter-spacing: 0.01em;
    max-width: 500px;
    margin: 0 auto 1.5rem;
  }

  .welcome-stats {
    display: inline-flex;
    align-items: center;
    gap: 1.5rem;
    padding: 0.75rem 1.5rem;
    background: var(--bg-secondary);
    border-radius: 8px;
    border: 1px solid var(--bg-tertiary);
  }

  .stat-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--text-secondary);
    text-decoration: none;
  }

  .stat-link {
    transition: color 0.15s ease;
  }

  .stat-link:hover {
    color: var(--accent-primary);
  }

  .stat-value {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--text-primary);
  }

  .stat-label {
    font-size: 0.875rem;
  }

  .stat-divider {
    width: 1px;
    height: 24px;
    background: var(--bg-tertiary);
  }

  /* Sections */
  .recent-section,
  .quick-links-section {
    margin-bottom: 2.5rem;
  }

  .section-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 1rem;
  }

  .section-title {
    font-size: 1rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--text-muted);
  }

  .section-link {
    font-size: 0.875rem;
    color: var(--link);
    text-decoration: none;
  }

  .section-link:hover {
    text-decoration: underline;
  }

  /* Notes Grid */
  .notes-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 1rem;
  }

  .note-card {
    border-radius: 8px;
    transition: transform 0.15s ease;
  }

  .note-card:hover {
    transform: translateY(-2px);
  }

  .note-card-link {
    display: block;
    padding: 1rem;
    background: var(--bg-secondary);
    border: 1px solid var(--bg-tertiary);
    border-radius: 8px;
    text-decoration: none;
    height: 100%;
    transition: border-color 0.15s ease;
  }

  .note-card-link:hover {
    border-color: var(--accent-primary);
  }

  .note-date {
    display: block;
    font-size: 0.6875rem;
    color: var(--text-muted);
    margin-bottom: 0.5rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .note-title {
    font-size: 1rem;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 0.5rem;
    line-height: 1.3;
    transition: color 0.15s ease;
  }

  .note-card-link:hover .note-title {
    color: var(--accent-primary);
  }

  .note-excerpt {
    font-size: 0.8125rem;
    color: var(--text-secondary);
    line-height: 1.5;
    margin-bottom: 0.75rem;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .note-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.375rem;
  }

  /* Empty State */
  .empty-state {
    text-align: center;
    padding: 3rem 1rem;
    color: var(--text-muted);
    background: var(--bg-secondary);
    border-radius: 8px;
    border: 1px solid var(--bg-tertiary);
  }

  .empty-hint {
    font-size: 0.875rem;
    margin-top: 0.5rem;
  }

  .empty-hint code {
    background: var(--bg-tertiary);
    padding: 0.125rem 0.375rem;
    border-radius: 4px;
    font-size: 0.8125rem;
  }

  /* Quick Links */
  .quick-links {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 0.75rem;
  }

  .quick-link {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 1rem;
    background: var(--bg-secondary);
    border: 1px solid var(--bg-tertiary);
    border-radius: 8px;
    text-decoration: none;
    transition: all 0.15s ease;
  }

  .quick-link:hover {
    border-color: var(--accent-primary);
    transform: translateY(-2px);
  }

  .quick-link-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: var(--bg-tertiary);
    border-radius: 8px;
    color: var(--accent-primary);
    flex-shrink: 0;
  }

  .quick-link-content {
    display: flex;
    flex-direction: column;
    gap: 0.125rem;
    min-width: 0;
  }

  .quick-link-title {
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--text-primary);
  }

  .quick-link-desc {
    font-size: 0.75rem;
    color: var(--text-muted);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  @media (max-width: 640px) {
    .notes-grid {
      grid-template-columns: 1fr;
    }

    .quick-links {
      grid-template-columns: 1fr;
    }

    .welcome-stats {
      flex-direction: column;
      gap: 0.75rem;
    }

    .stat-divider {
      width: 100%;
      height: 1px;
    }
  }
</style>
