---
title: "1/6 개발 진행 상황"
date: 2026-01-06
tags: ["Service"]
---

# 페이지 캡쳐

![](https://prod-files-secure.s3.us-west-2.amazonaws.com/7d3f0df6-bde9-4f54-8dfd-2a03a9515f90/cf5e1033-99f3-40d9-ae60-ebdda559efab/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466RMURI6ZN%2F20260106%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260106T141349Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJb%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCIDxFRXjXs4oYAI1alPfvPEIfvOod57bcacNSnCO0qCTtAiAkpU9sCepg8UxWSkquvtFb6MF58ts3Om08iOEN2WN6byr%2FAwhfEAAaDDYzNzQyMzE4MzgwNSIM%2FsyAEwLqwos2QAGAKtwDhim9POxVDUsXIFnjEoSRSXXVmMihMb1BgEIDy4EI1T%2Bsosr4%2B6O9fJ6n6DpOlvnYWWDAqmvw2i%2BSveo9Rz%2BB4kbjX1bFf7Abznnn2VBqhV0m9Iu59eHfkZG5vnTXWV7XcMwWO3Ew2%2BNgMzmpgS61w2AwhXWdOO%2BjtxGbmENQwZc%2B9ir1lrezDurQQg%2Bx%2F8djZo%2Fuy4jj4lE6TwXt44%2Bsa1%2FJIPtVyJwNQ80xwhLb1paZSYbeHE9VDnLEaUhJGQdsmxFkJakcHkDvhfltft%2F4and0BGaUE%2Fub5rNDZ7N1ggXqFsthI7h4w8M87dXEWPEDJuqJJgVd4mVk7FlcAK8YMXm2mCLzUhIei2%2F3W8wsRhvAvYZDXuUtByRNlq%2BvnQMLsiqv%2BZsQHxQtovT6f45vYdNS6wZxT2tgDMU6qM5vHJ1e0wvUkyUG%2Fakxe4%2BcFcGMmH%2B8kiGF%2FGPR6l5hBLglM7jszgz5ydwwlooeZoNxoj2bXJvkP1Oj3voYSE%2Brk%2F0hXqMBeLbUaZLWa%2BuYYfsLFhieEladWq81fwZnxi0QwnMroKfKdCxEHwfQ3Dbjw5f6Ci3VJyCCxli2ulGZ%2F1E361xTmWWIGW%2ByNoMpKwpaFQJcKJ35%2B9ttFPi6Iz4w%2Fqb0ygY6pgEwNyPMpDyjPnuTBs5M2rJWfozc40pLCIyJ8tTnsza0XsMauBux5bbl8OVlwz0PlZjHadqn1fYaulchawDSf%2FM2gdcA9tstqJbA9W%2F4N3ukWobdIY8J4lA%2BTOc%2By4cIW1CDoNmho5Qn%2BhS6mEKLcGXD%2BXosUDMgQp1yWO3CZcqutc1IhSOOb8e3JywSChk5HMjXvZvfGbLVzOaUc5dmC%2FAlAr%2BV4GMt&X-Amz-Signature=7bd503dcac578e4c336c778ac8677af00d5d205bb03a3d3abb0f05c551e20e39&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

![](https://prod-files-secure.s3.us-west-2.amazonaws.com/7d3f0df6-bde9-4f54-8dfd-2a03a9515f90/9466b5a9-0505-4f1a-8d5c-a0659b7bc7e4/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466RMURI6ZN%2F20260106%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260106T141349Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJb%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCIDxFRXjXs4oYAI1alPfvPEIfvOod57bcacNSnCO0qCTtAiAkpU9sCepg8UxWSkquvtFb6MF58ts3Om08iOEN2WN6byr%2FAwhfEAAaDDYzNzQyMzE4MzgwNSIM%2FsyAEwLqwos2QAGAKtwDhim9POxVDUsXIFnjEoSRSXXVmMihMb1BgEIDy4EI1T%2Bsosr4%2B6O9fJ6n6DpOlvnYWWDAqmvw2i%2BSveo9Rz%2BB4kbjX1bFf7Abznnn2VBqhV0m9Iu59eHfkZG5vnTXWV7XcMwWO3Ew2%2BNgMzmpgS61w2AwhXWdOO%2BjtxGbmENQwZc%2B9ir1lrezDurQQg%2Bx%2F8djZo%2Fuy4jj4lE6TwXt44%2Bsa1%2FJIPtVyJwNQ80xwhLb1paZSYbeHE9VDnLEaUhJGQdsmxFkJakcHkDvhfltft%2F4and0BGaUE%2Fub5rNDZ7N1ggXqFsthI7h4w8M87dXEWPEDJuqJJgVd4mVk7FlcAK8YMXm2mCLzUhIei2%2F3W8wsRhvAvYZDXuUtByRNlq%2BvnQMLsiqv%2BZsQHxQtovT6f45vYdNS6wZxT2tgDMU6qM5vHJ1e0wvUkyUG%2Fakxe4%2BcFcGMmH%2B8kiGF%2FGPR6l5hBLglM7jszgz5ydwwlooeZoNxoj2bXJvkP1Oj3voYSE%2Brk%2F0hXqMBeLbUaZLWa%2BuYYfsLFhieEladWq81fwZnxi0QwnMroKfKdCxEHwfQ3Dbjw5f6Ci3VJyCCxli2ulGZ%2F1E361xTmWWIGW%2ByNoMpKwpaFQJcKJ35%2B9ttFPi6Iz4w%2Fqb0ygY6pgEwNyPMpDyjPnuTBs5M2rJWfozc40pLCIyJ8tTnsza0XsMauBux5bbl8OVlwz0PlZjHadqn1fYaulchawDSf%2FM2gdcA9tstqJbA9W%2F4N3ukWobdIY8J4lA%2BTOc%2By4cIW1CDoNmho5Qn%2BhS6mEKLcGXD%2BXosUDMgQp1yWO3CZcqutc1IhSOOb8e3JywSChk5HMjXvZvfGbLVzOaUc5dmC%2FAlAr%2BV4GMt&X-Amz-Signature=ffc805ef8086aeb54321d0129067528184c13fd723d81a9794611709e48f242c&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


# 서비스 개선점

1. **이동 평균선과 정배열, 역배열이 없다. 240일선, 120일선, 60일선, 20일선 → API로 바로 구현 가능 혹은 계산 필요한지 판단 → 해결**
1. **실시간 통신(websocket)으로 관리가 가능한지 봐야함 
→ 차트/캔들 데이터는 항상 RestAPI로 제공, 나머지는 WebSocket으로 전환 가능**
1. 모든 API 데이터들이 숫자로 나오는지 확인해야 함 
1. 그 데이터가 가져온 매수조건에 해당한다면 트리거를 발생시켜야 함
ex)삼성전자의 30분봉이 이평성 혹은 정배열상 조건에 해당한다면 트리거 발동 
1. 트리거는 관심종목 창에 노란색 배경으로 깜빡임 + 해당 종목의 창으로 이동 
1. 홈페이지 창에서 상세 종목 페이지를 새로 띄워 보여주고, 트리거 대상이 되는 데이터 바로 밑에 화살표를 깜빡이는 방식으로 트리거 발동

# UI/UX 개선점

1. 홈페이지 이동 버튼 필요
1. 이평선은 선만 나타내고 차트에는 글자가 나타나지 않게 수정
1. 채결량의 스크롤이 화면에 방해되지 않게 수정

# 오늘의 트러블 슈팅

### **문제 1**

- 현재가, 호가, 체결내역 API 호출 시 간헐적 500 에러 발생 (curl)
- 에러 메시지: `Internal server error`, `KIS API 요청 실패`
### 문제 2

- 종목 상세 페이지 진입 시 차트가 빈 화면으로 표시 (브라우저)
- 브라우저에서 동시에 4개 API 호출 (candles, orderbook, price, executions)
- KIS VTS API가 동시 요청 중 일부/전체에 500 에러 반환
---

### **접근 1**

- **원인 분석**: KIS VTS(가상투자서비스) API의 속도 제한 또는 일시적 서버 오류
- **확인 방법**:
  - 백엔드 로그 확인: `docker logs trade-backend`
  - KIS API 응답 코드 확인: `tr_id`, `msg_cd`, `msg1` 필드 분석
> 💡 ****


### **접근 2**

- **원인 분석**:
  - curl 단일 요청: ✅ 성공 (캔들 데이터 정상 반환)
  - 브라우저 동시 요청: ❌ 500 에러 (Rate Limiting)
  - 이유 : KIS VTS API는 초당 약 5회 요청 제한(Rate Limit)을 적용한다. curl로 단일 요청 시에는 순차적으로 처리되어 제한에 걸리지 않지만, 브라우저는 종목 상세 페이지 로드 시 4개 API(price, orderbook, executions, candles)를 거의 동시에 요청한다. 이로 인해 KIS API의 sliding window 방식 Rate Limit에 걸려 일부 요청이 500 에러를 반환한다. 현재 백엔드에 Semaphore(1) + 250ms 지연을 적용하여 에러율이 29%→9%로 개선되었으나, 동시 접속자 증가나 여러 종목 연속 조회 시 여전히 제한에 걸릴 수 있어 WebSocket 전환이 근본적인 해결책이다.
- **증거:**
```bash
# 단일 요청 - 성공
curl "http://localhost:8000/api/v1/stocks/005930/candles?period=D&count=10"
# → [{"date":"20260106","open_price":135300,...}]

# 브라우저 동시 요청 - 실패
# candles, orderbook, price, executions 동시 호출 → 500 에러
```

---

### 해결 시도

- **근본 원인**: KIS VTS API의 동시 요청 Rate Limiting (슬라이딩 윈도우, 초당 5건)
- **백엔드 시도**:
- [x] Semaphore(1)로 동시 요청 직렬화
- [x] 요청 간 250ms 딜레이 추가 (초당 4건, 여유분 확보)
- [x] TTL 캐싱으로 중복 요청 방지 (price: 2초, orderbook: 1초, executions: 3초, candles: 60초)
- **프론트엔드 시도**:
- [x] API 호출 시차 로딩 (price: 0ms → orderbook: 300ms → executions: 600ms → candles: 900ms)
- [x] 차트 컴포넌트에 에러 상태 UI 추가
- [x] 재시도 버튼 제공
---

## 결과

개선 효과 있음 - 에러율이 29% → 9%로 약 69% 감소

남은 9% 에러의 가능 원인:

- 캐시 미스 시 동시 요청 발생 ?

다음 시도 → WebSocket으로 접근(단, 차트,캔들 데이터는 Rest API)